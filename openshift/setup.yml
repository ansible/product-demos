---
controller_components:
  - execution_environments
  - credential_types
  - credentials
  - inventory_sources
  - job_templates
  - workflow_job_templates

controller_credential_types:
  - name: Usable Automation Hub Credential
    kind: cloud
    description: A credential we can use from a playbook to interact with Automation Hub
    inputs:
      fields:
        - id: registry_username
          type: string
          label: Registry Username
        - id: registry_password
          type: string
          label: Registry Password
          secret: true
        - id: ah_token
          type: string
          label: Automation Hub Token
          secret: true
    injectors:
      env:
        REGISTRY_USERNAME: !unsafe '{{ registry_username }}'
        REGISTRY_PASSWORD: !unsafe '{{ registry_password }}'
        AH_TOKEN: !unsafe '{{ ah_token }}'

controller_credentials:
  - name: Usable Hub Credential
    organization: Default
    credential_type: Usable Automation Hub Credential
    state: exists
    inputs:
      registry_username: CHANGEME
      registry_password: CHANGEME
      ah_token: CHANGEME

  - name: OpenShift Credential
    organization: Default
    credential_type: OpenShift or Kubernetes API Bearer Token
    state: exists
    inputs:
      host: CHANGEME
      bearer_token: CHANGEME
      verify_ssl: false

controller_inventory_sources:
  - name: OpenShift CNV Inventory
    inventory: Demo Inventory
    source: scm
    source_project: Ansible official demo project
    source_path: openshift/inventory.kubevirt.yml
    credential: OpenShift Credential
    update_on_launch: false

controller_templates:
  - name: OpenShift / EDA / Install Controller
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/eda/install.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    credentials:
      - "OpenShift Credential"
      - "Controller Credential"

  - name: OpenShift / Hub / Install Automation Hub
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/hub/install.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    credentials:
      - "OpenShift Credential"
      - "Controller Credential"

  - name: OpenShift / Hub / Sync Collection Repositories
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/hub/collections.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    credentials:
      - "Controller Credential"
      - "Usable Hub Credential"
    extra_vars:
      ah_collection_remotes:
        - name: rh-certified
          url: https://console.redhat.com/api/automation-hub/content/published/
          auth_url: https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token

  - name: OpenShift / Hub / Sync EE Registries
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/hub/registries.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    credentials:
      - "Controller Credential"
      - "Usable Hub Credential"
    extra_vars:
      ah_ee_registries:
        - name: rh-registry
          url: https://registry.redhat.io
      ah_ee_images:
        - name: "ansible-automation-platform-24/ee-supported-rhel9"

  - name: OpenShift / CNV / Install Operator
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/cnv/install.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    credentials:
      - "OpenShift Credential"

  - name: OpenShift / CNV / Create RHEL VM
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/cnv/provision_rhel.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    allow_simultaneous: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: VM name
          type: text
          variable: vm_name
          default: rhel9
          required: true
        - question_name: VM NameSpace
          type: text
          variable: vm_namespace
          default: openshift-cnv
          required: true
        - question_name: SSH Authorized Key
          type: textarea
          variable: ssh_authorized_key
          required: true
        - question_name: OS Version
          type: text
          variable: os_version
          default: rhel9
          required: true
        - question_name: RHEL Activation Key
          type: text
          variable: rh_subscription_key
          required: true
        - question_name: RHEL Organization ID
          type: text
          variable: rh_subscription_org
          required: true
    credentials:
      - "OpenShift Credential"

  - name: OpenShift / CNV / Delete VM
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/cnv/provision.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    extra_vars:
      instance_state: absent
    survey:
      name: ''
      description: ''
      spec:
        - question_name: VM name
          type: text
          variable: vm_name
          required: true
        - question_name: VM NameSpace
          type: text
          variable: vm_namespace
          default: openshift-cnv
          required: true
    credentials:
      - "OpenShift Credential"

  - name: OpenShift / CNV / Patching
    job_type: check
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/cnv/patch.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    ask_job_type_on_launch: true
    credentials:
      - "OpenShift Credential"
      - "Demo Credential"
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Server Name or Pattern
          type: text
          variable: _hosts
          default: "openshift-cnv-rhel*"
          required: true

  - name: OpenShift / CNV / Wait Hosts
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/cnv/wait.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Wait hosts
          type: text
          variable: _hosts
          default: "openshift-cnv-rhel*"
          required: true

  - name: OpenShift / Dev Spaces
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/devspaces.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    credentials:
      - "OpenShift Credential"

  - name: OpenShift / GitLab
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "openshift/gitlab.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    credentials:
      - "OpenShift Credential"

controller_workflows:
  - name: OpenShift / CNV / Infra Stack
    description: A workflow to deploy Virtualized infra in OCP Virtalization
    organization: Default
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: SSH Authorized Key
          type: textarea
          variable: ssh_authorized_key
          required: true
        - question_name: RHEL Activation Key
          type: text
          variable: rh_subscription_key
          required: true
        - question_name: RHEL Organization ID
          type: text
          variable: rh_subscription_org
          required: true
    simplified_workflow_nodes:
      - identifier: Deploy RHEL8 VM
        unified_job_template: OpenShift / CNV / Create RHEL VM
        extra_data:
          vm_name: rhel8
          os_version: rhel8
        success_nodes:
          - Update Inventory
        failure_nodes:
          - Ticket - Instance Failed
      - identifier: Deploy RHEL9 VM
        unified_job_template: OpenShift / CNV / Create RHEL VM
        extra_data:
          vm_name: rhel9
          os_version: rhel9
        success_nodes:
          - Update Inventory
        failure_nodes:
          - Ticket - Instance Failed
      - identifier: Update Inventory
        unified_job_template: OpenShift CNV Inventory
      - identifier: Ticket - Instance Failed
        unified_job_template: 'SUBMIT FEEDBACK'
        extra_data:
          feedback: Failed to create CNV instance

  - name: OpenShift / Hub / Deploy Automation Hub and sync EEs and Collections
    description: A workflow to deploy Automation Hub and sync repositories
    organization: Default
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    survey_enabled: true
    simplified_workflow_nodes:
      - identifier: Install AH using AAP Operator
        unified_job_template: OpenShift / Hub / Install Automation Hub
        success_nodes:
          - Sync EEs
        failure_nodes:
          - Ticket - Instance Failed
      - identifier: Sync EEs
        unified_job_template: OpenShift / Hub / Sync EE Registries
        success_nodes:
          - Sync Collections
        failure_nodes:
          - Ticket - Instance Failed
      - identifier: Sync Collections
        unified_job_template: OpenShift / Hub / Sync Collection Repositories
        failure_nodes:
          - Ticket - Instance Failed
      - identifier: Ticket - Instance Failed
        unified_job_template: 'SUBMIT FEEDBACK'
        extra_data:
          feedback: Failed to deploy Automation Hub on OCP
